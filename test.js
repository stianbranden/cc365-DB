const data = `,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,,,,Evaluation Calibration,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,,,Contact ID,,,Called Number,,,Calling Number,,Call Duration,Contact Date,,,Contact Time,,Stian Branden,,,Teemu Avonius,,,Hanna Ida Karlsson,,,Jonas Hungnes,,,,,Emma Winther,,,,,,,,,,,,,
,Eval Form,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,Quality Assurance - Phone v 4.0,,1059000,,,100041,,,+4922047..,,0:03:01,8/20/2024,,,8:01 PM,,0.00,,,0.00,,,78.00,,,67.00,,,,,0.00,,,,,,,,,,,,,
,,,,,,,,11.00,,,,,,,,,,0.00,,,100.00,,,100.00,,,0.00,,,100.00,,,,,,,,,,,,,,
,Section:,,Introduction,,,,,,,,,,,Section Score (%),,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,Question,,,,,,Weight(%),,,KPI,,,Question Type,,,Possible Score,,,Score(%):,,,Score(%):,,,Score(%):,,,Score(%):,,,,,Score(%):,,,,Score(%):,,Score(%):,Score(%):,Score(%):,Score(%):,,
,1.1  Are we meeting the requirements?,,,,,,100.00,,,N,,,,,,100.00,,,0.00,,,100.00,,,100.00,,,0.00,,,,100.00,,,,,,,,,,,,
,,,,,,,,11.00,,,,,,,,,,0.00,,,100.00,,,0.00,,,0.00,,,100.00,,,,,,,,,,,,,,
,Section:,,Analysis,,,,,,,,,,,Section Score (%),,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,Question,,,,,,Weight(%),,,KPI,,,Question Type,,,Possible Score,,,Score(%):,,,Score(%):,,,Score(%):,,,Score(%):,,,,,Score(%):,,,,Score(%):,,Score(%):,Score(%):,Score(%):,Score(%):,,
,2.1  Are we meeting the requirements?,,,,,,100.00,,,N,,,,,,100.00,,,0.00,,,100.00,,,0.00,,,0.00,,,,100.00,,,,,,,,,,,,
,,,,,,,,11.00,,,,,,,,,,0.00,,,100.00,,,100.00,,,0.00,,,100.00,,,,,,,,,,,,,,
,Section:,,Routines,,,,,,,,,,,Section Score (%),,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,Question,,,,,,Weight(%),,,KPI,,,Question Type,,,Possible Score,,,Score(%):,,,Score(%):,,,Score(%):,,,Score(%):,,,,,Score(%):,,,,Score(%):,,Score(%):,Score(%):,Score(%):,Score(%):,,
,3.1  Are we meeting the requirements?,,,,,,100.00,,,N,,,,,,100.00,,,0.00,,,100.00,,,100.00,,,0.00,,,,100.00,,,,,,,,,,,,
,,,,,,,,11.00,,,,,,,,,,0.00,,,100.00,,,100.00,,,100.00,,,0.00,,,,,,,,,,,,,,
,Section:,,Solution,,,,,,,,,,,Section Score (%),,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,Question,,,,,,Weight(%),,,KPI,,,Question Type,,,Possible Score,,,Score(%):,,,Score(%):,,,Score(%):,,,Score(%):,,,,,Score(%):,,,,Score(%):,,Score(%):,Score(%):,Score(%):,Score(%):,,
,4.1  Are we meeting the requirements?,,,,,,100.00,,,Y,,,,,,100.00,,,0.00,,,100.00,,,100.00,,,100.00,,,,0.00,,,,,,,,,,,,
,,,,,,,,11.00,,,,,,,,,,0.00,,,100.00,,,100.00,,,100.00,,,100.00,,,,,,,,,,,,,,
,Section:,,Communication,,,,,,,,,,,Section Score (%),,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,Question,,,,,,Weight(%),,,KPI,,,Question Type,,,Possible Score,,,Score(%):,,,Score(%):,,,Score(%):,,,Score(%):,,,,,Score(%):,,,,Score(%):,,Score(%):,Score(%):,Score(%):,Score(%):,,
,5.1  Voice control,,,,,,50.00,,,N,,,,,,50.00,,,0.00,,,50.00,,,50.00,,,50.00,,,,50.00,,,,,,,,,,,,
,5.2  Wording,,,,,,50.00,,,N,,,,,,50.00,,,0.00,,,50.00,,,50.00,,,50.00,,,,50.00,,,,,,,,,,,,
,,,,,,,,11.00,,,,,,,,,,100.00,,,100.00,,,100.00,,,100.00,,,100.00,,,,,,,,,,,,,,
,Section:,,GDPR,,,,,,,,,,,Section Score (%),,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,Question,,,,,,Weight(%),,,KPI,,,Question Type,,,Possible Score,,,Score(%):,,,Score(%):,,,Score(%):,,,Score(%):,,,,,Score(%):,,,,Score(%):,,Score(%):,Score(%):,Score(%):,Score(%):,,
,6.1  Are we meeting the requirements?,,,,,,100.00,,,Y,,,,,,100.00,,,100.00,,,100.00,,,100.00,,,100.00,,,,100.00,,,,,,,,,,,,
,,,,,,,,11.00,,,,,,,,,,100.00,,,0.00,,,0.00,,,100.00,,,100.00,,,,,,,,,,,,,,
,Section:,,Notes,,,,,,,,,,,Section Score (%),,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,Question,,,,,,Weight(%),,,KPI,,,Question Type,,,Possible Score,,,Score(%):,,,Score(%):,,,Score(%):,,,Score(%):,,,,,Score(%):,,,,Score(%):,,Score(%):,Score(%):,Score(%):,Score(%):,,
,7.1  Are we meeting the requirements?,,,,,,100.00,,,N,,,,,,100.00,,,100.00,,,0.00,,,0.00,,,100.00,,,,100.00,,,,,,,,,,,,
,,,,,,,,11.00,,,,,,,,,,0.00,,,0.00,,,100.00,,,100.00,,,0.00,,,,,,,,,,,,,,
,Section:,,Voice of the customer,,,,,,,,,,,Section Score (%),,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,Question,,,,,,Weight(%),,,KPI,,,Question Type,,,Possible Score,,,Score(%):,,,Score(%):,,,Score(%):,,,Score(%):,,,,,Score(%):,,,,Score(%):,,Score(%):,Score(%):,Score(%):,Score(%):,,
,8.1  Are we meeting the requirements?,,,,,,100.00,,,Y,,,,,,100.00,,,0.00,,,0.00,,,100.00,,,100.00,,,,0.00,,,,,,,,,,,,
,,,,,,,,12.00,,,,,,,,,,0.00,,,100.00,,,100.00,,,100.00,,,0.00,,,,,,,,,,,,,,
,Section:,,Exit,,,,,,,,,,,Section Score (%),,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,Question,,,,,,Weight(%),,,KPI,,,Question Type,,,Possible Score,,,Score(%):,,,Score(%):,,,Score(%):,,,Score(%):,,,,,Score(%):,,,,Score(%):,,Score(%):,Score(%):,Score(%):,Score(%):,,
,9.1  Are we meeting the requirements?,,,,,,100.00,,,N,,,,,,100.00,,,0.00,,,100.00,,,100.00,,,100.00,,,,0.00,,,,,,,,,,,,
,Form Comments,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,Stian Branden,,,,"To fast, not able to understand intro",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,,,,,"Shitty bad, we need to help our customers",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,,,,,"Botched call, to flat exit",,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,Hanna Ida Karlsson,,,,Test,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,,,,,Test,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,,,,,Test,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,,,,,Test,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,,[Contact]:1059000,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
,,Page:,1 / 1,,,,,,,,,,,,,,,,,,,,,,,,,,Run Date:,,,,,"September 23, 2024 4:04 PM",,,,,,,,,,
`


function parse(lines, gauge){
    // const lines = data.split('\n')
    const names = []
    let start = false
    const primaryNameRow = lines[4].split(',')
    const secondaryNameRow = lines[5].split(',')
    primaryNameRow.forEach((a, index)=>{
        if (start) {
            const b = secondaryNameRow[index]
            if (a.length > 3) names.push(a)
            else if (b.length>3) names.push(b)
        }
        else if (a === 'Contact Time') start = true
    })
    console.log(names);
    
    
    const questionsWithScore = []
    lines.forEach((line, index)=>{
        if (line.split(',')[1] === 'Question'){
            for ( let i = index+1; i < lines.length; i++){
                const nextLine = lines[i].split(',')
                if (nextLine[1] === 'Form Comments') break
                else if ( nextLine[1].length > 3 ){
                    const arr = []
                    nextLine.forEach(a=>{
                        if (a.length > 0) arr.push(a)
                    })
                    questionsWithScore.push(arr)
                }
                else break
            }
    
        }
    })
    console.log(questionsWithScore);
    

    const evaluations = []
    names.forEach((name, index)=>{
        const comments = []
        lines.forEach((line, index)=>{
            const f = line.split(',')
            if ( f[1] === 'Form Comments'){
                for ( let j = index+1; j< lines.length-1; j++){
                    const comName = lines[j].split(',')[1]
                    if (comName.length && comName === name ){
                        for ( let k = j; k < lines.length-2; k++){
                            const comLine = lines[k].split(',')
                            let comment = comLine[5]
                            if (comment.startsWith('"')){
                                const full = lines.join('')
                                const start = full.indexOf(comment)
                                const lastPart = full.slice(start)
                                comment = lastPart.slice(1, lastPart.indexOf('",'))
                                // console.log({start, lastPart, comment});
                                
                            }
                            const commentName = comLine[1]
                            
                            if ( comment && comment.length && (commentName.length === 0 || commentName === name)) {
                                // console.log({k, comment, commentName, name});
                                comments.push(comment)
                            }
                            if ( commentName.length > 0 && commentName != name){
                                // console.log({k, line: lines[k], comment, commentName, comNameL: commentName?.length, name, break: 'yes'});
                                break; 
                            }
                            else
                            {
                                // console.log({k, line: lines[k], comment, commentName, comNameL: commentName?.length, name, break: 'no'});
                                
                            } 
                        }
                    }
                }
            }
        })

        const obj = {evaluator: name, isGauge: name === gauge, scores: [], accuracy: [], comments}
        questionsWithScore.forEach(qline=>{
            obj.scores.push(Number(qline.slice(-names.length)[index]))
        })
        evaluations.push(obj)
    })
    console.log(evaluations);
    
    evaluations.forEach(e=>{
        if (!e.isGauge){
            const gauge = evaluations.filter(a=>a.isGauge)[0]
            e.scores.forEach((s, index)=>{
                if (s === gauge.scores[index]) e.accuracy.push(1)
                else e.accuracy.push(0)
            })
        }
    })

    console.log(evaluations);
    return 
}

parse (data.split('\n'), "Stian Branden")
